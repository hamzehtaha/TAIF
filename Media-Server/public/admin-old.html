<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAIF Media Management System - Admin Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .header {
            background: rgba(0, 0, 0, 0.7);
            border-bottom: 2px solid #00d4ff;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            color: #00d4ff;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .server-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: rgba(0, 212, 255, 0.1);
            border-radius: 5px;
            border: 1px solid #00d4ff;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff00;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .nav-tabs {
            display: flex;
            gap: 5px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            border-bottom: 2px solid transparent;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            font-weight: 500;
        }

        .nav-tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-tab.active {
            border-bottom-color: #00d4ff;
            color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Upload Section */
        .upload-section {
            background: rgba(0, 0, 0, 0.5);
            border: 2px dashed #00d4ff;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 30px;
        }

        .upload-section:hover {
            background: rgba(0, 212, 255, 0.1);
            border-color: #00ffff;
        }

        .upload-section.dragover {
            background: rgba(0, 212, 255, 0.2);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .upload-section h2 {
            color: #00d4ff;
            margin-bottom: 10px;
        }

        .upload-section p {
            color: #a0a0a0;
            margin-bottom: 20px;
        }

        #fileInput {
            display: none;
        }

        .upload-button {
            background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%);
            color: #000;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 212, 255, 0.3);
        }

        .upload-progress {
            display: none;
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .upload-progress.show {
            display: block;
        }

        .progress-bar {
            width: 100%;
            height: 25px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d4ff, #00ffff);
            width: 0%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }

        /* Video Grid */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .video-card {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .video-card:hover {
            transform: translateY(-5px);
            border-color: #00d4ff;
            box-shadow: 0 8px 16px rgba(0, 212, 255, 0.2);
        }

        .video-thumbnail {
            width: 100%;
            height: 160px;
            background: rgba(0, 212, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
        }

        .video-info {
            padding: 15px;
        }

        .video-title {
            color: #00d4ff;
            font-weight: bold;
            margin-bottom: 8px;
            word-break: break-word;
        }

        .video-meta {
            font-size: 12px;
            color: #a0a0a0;
            margin-bottom: 10px;
        }

        .video-url {
            font-size: 11px;
            color: #00d4ff;
            background: rgba(0, 212, 255, 0.1);
            padding: 8px;
            border-radius: 4px;
            margin: 8px 0;
            word-break: break-all;
            border: 1px solid rgba(0, 212, 255, 0.3);
        }

        .video-actions {
            display: flex;
            gap: 8px;
            margin-top: 12px;
            flex-wrap: wrap;
        }

        .btn-small {
            flex: 1;
            padding: 8px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-play {
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: #000;
        }

        .btn-play:hover {
            transform: scale(1.05);
        }

        .btn-delete {
            background: rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
        }

        .btn-delete:hover {
            background: rgba(255, 0, 0, 0.5);
        }

        /* Video Table Styles */
        .video-table-container {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
        }

        .video-table {
            width: 100%;
            border-collapse: collapse;
        }

        .video-table thead {
            background: rgba(0, 212, 255, 0.2);
        }

        .video-table th {
            padding: 15px;
            text-align: left;
            color: #00d4ff;
            font-weight: bold;
            font-size: 14px;
            border-bottom: 2px solid #00d4ff;
        }

        .video-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(0, 212, 255, 0.1);
            color: #e0e0e0;
            font-size: 13px;
        }

        .video-table tbody tr {
            transition: background 0.3s ease;
        }

        .video-table tbody tr:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        .resolution-badges {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .resolution-badge {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid #00d4ff;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 11px;
            color: #00d4ff;
        }

        .table-actions {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .table-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .table-btn.play {
            background: #00d4ff;
            color: #000;
        }

        .table-btn.delete {
            background: rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
            border: 1px solid #ff6b6b;
        }

        .table-btn.copy {
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            border: 1px solid #00d4ff;
        }

        .table-btn:hover {
            transform: scale(1.05);
        }

        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .view-toggle button {
            padding: 8px 16px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid #00d4ff;
            color: #00d4ff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-toggle button.active {
            background: #00d4ff;
            color: #000;
        }

        /* Player Section */
        .player-section {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .player-container {
            margin-top: 20px;
        }

        video {
            width: 100%;
            border-radius: 5px;
            background: #000;
        }

        .player-controls {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-label {
            font-size: 12px;
            color: #a0a0a0;
        }

        .quality-selector {
            padding: 8px 12px;
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid #00d4ff;
            color: #00d4ff;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        /* Stats Section */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid #00d4ff;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 32px;
            color: #00d4ff;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            font-size: 12px;
            color: #a0a0a0;
            text-transform: uppercase;
        }

        .stat-unit {
            font-size: 14px;
            color: #a0a0a0;
        }

        /* Test Section */
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .test-card {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
        }

        .test-card h3 {
            color: #00d4ff;
            margin-bottom: 15px;
        }

        .test-input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.3);
            color: #e0e0e0;
            border-radius: 4px;
            font-family: monospace;
        }

        .test-input::placeholder {
            color: #666;
        }

        .test-button {
            width: 100%;
            padding: 10px;
            margin-top: 10px;
            background: linear-gradient(135deg, #00d4ff, #0099cc);
            color: #000;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            transform: scale(1.02);
        }

        .test-result {
            margin-top: 15px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-left: 3px solid #00d4ff;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .test-result.show {
            display: block;
        }

        .result-success {
            border-left-color: #00ff00;
            color: #00ff00;
        }

        .result-error {
            border-left-color: #ff6b6b;
            color: #ff6b6b;
        }

        /* Settings Section */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .setting-card {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(0, 212, 255, 0.3);
            border-radius: 8px;
            padding: 20px;
        }

        .setting-card h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 16px;
        }

        .setting-item {
            margin-bottom: 15px;
        }

        .setting-label {
            display: block;
            font-size: 12px;
            color: #a0a0a0;
            margin-bottom: 5px;
        }

        .setting-value {
            color: #e0e0e0;
            font-family: monospace;
            font-size: 13px;
            padding: 8px 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            border-left: 2px solid #00d4ff;
        }

        /* Info Section */
        .info-section {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid #00d4ff;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .info-section h3 {
            color: #00d4ff;
            margin-bottom: 15px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .info-item {
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
        }

        .info-label {
            font-size: 12px;
            color: #a0a0a0;
            margin-bottom: 5px;
        }

        .info-value {
            color: #e0e0e0;
            font-weight: bold;
        }

        /* Message Box */
        .message-box {
            padding: 15px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-box.show {
            display: block;
        }

        .message-success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid #00ff00;
            color: #00ff00;
        }

        .message-error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid #ff6b6b;
            color: #ff6b6b;
        }

        .message-info {
            background: rgba(0, 212, 255, 0.2);
            border: 1px solid #00d4ff;
            color: #00d4ff;
        }

        /* No Data Message */
        .no-data {
            text-align: center;
            padding: 40px;
            color: #a0a0a0;
        }

        .no-data-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* Footer */
        .footer {
            background: rgba(0, 0, 0, 0.7);
            border-top: 2px solid #00d4ff;
            padding: 20px;
            text-align: center;
            color: #a0a0a0;
            margin-top: 50px;
        }

        .footer p {
            margin: 5px 0;
        }

        .footer a {
            color: #00d4ff;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-info {
                flex-direction: column;
                align-items: flex-start;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .nav-tab {
                width: 100%;
            }

            .video-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .upload-section {
                padding: 20px;
            }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 212, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Real-time progress styles */
        .progress-stage {
            color: #00d4ff;
            font-size: 12px;
            margin-top: 5px;
        }

        .upload-message {
            color: #a0a0a0;
            font-size: 11px;
            margin-top: 3px;
        }
    </style>
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-info">
            <div>
                <h1>üìπ TAIF Media Management System</h1>
                <p style="color: #a0a0a0; font-size: 12px;">Admin Portal - Professional Video Streaming Platform</p>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <span id="userInfo" style="color: #00d4ff; font-size: 14px;"></span>
                <div class="server-status">
                    <div class="status-indicator"></div>
                    <span id="serverStatus">Server Connected</span>
                </div>
                <button onclick="logout()" style="background: rgba(255,0,0,0.2); border: 1px solid #ff0000; color: #ff0000; padding: 8px 16px; border-radius: 4px; cursor: pointer; font-size: 12px;">Logout</button>
            </div>
        </div>
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('upload')">üì§ Upload</button>
            <button class="nav-tab" onclick="switchTab('videos')">üé¨ My Videos</button>
            <button class="nav-tab" onclick="switchTab('player')">‚ñ∂Ô∏è Player</button>
            <button class="nav-tab" onclick="switchTab('testing')">üß™ Testing</button>
            <button class="nav-tab" onclick="switchTab('stats')">üìä Statistics</button>
            <button class="nav-tab" onclick="switchTab('settings')">‚öôÔ∏è Settings</button>
            <button class="nav-tab" onclick="switchTab('logs')">üìã Logs</button>
        </div>
    </div>

    <div class="container">
        <div id="messageBox" class="message-box"></div>

        <!-- Upload Tab -->
        <div id="upload" class="tab-content active">
            <h2 style="color: #00d4ff; margin-bottom: 20px;">üì§ Upload New Video</h2>
            <div class="upload-section" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">üìÅ</div>
                <h2>Drop Your Video Here</h2>
                <p>or click to browse (Supports MP4, MKV, AVI, MOV)</p>
                <button class="upload-button">Choose Video</button>
            </div>
            <input type="file" id="fileInput" accept="video/*">
            <div class="upload-progress" id="uploadProgress">
                <div id="progressText">
                    <p id="uploadStatus"></p>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
                </div>
                <p style="text-align: center; color: #a0a0a0; font-size: 12px;">Please wait, this may take several minutes...</p>
            </div>
        </div>

        <!-- Videos Tab -->
        <div id="videos" class="tab-content">
            <h2 style="color: #00d4ff; margin-bottom: 20px;">üé¨ My Videos (<span id="videoCount">0</span>)</h2>
            
            <div class="view-toggle">
                <button id="viewTableBtn" class="active" onclick="switchView('table')">üìä Table View</button>
                <button id="viewGridBtn" onclick="switchView('grid')">üé¨ Grid View</button>
            </div>

            <!-- Table View -->
            <div id="videoTableView" class="video-table-container">
                <table class="video-table">
                    <thead>
                        <tr>
                            <th>Video Name</th>
                            <th>Duration</th>
                            <th>Resolutions</th>
                            <th>File Size</th>
                            <th>Upload Date</th>
                            <th>Streaming URLs</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="videoTableBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: #a0a0a0;">
                                <div class="no-data-icon" style="font-size: 48px;">üì≠</div>
                                <p>No videos uploaded yet</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Grid View -->
            <div id="videoGridView" class="video-grid" style="display: none;"></div>
        </div>

        <!-- Player Tab -->
        <div id="player" class="tab-content">
            <h2 style="color: #00d4ff; margin-bottom: 20px;">‚ñ∂Ô∏è Video Player</h2>
            <div class="player-section">
                <h3 style="margin-bottom: 15px;">Select a Video</h3>
                <select id="playerVideoSelect" style="width: 100%; padding: 10px; background: rgba(255,255,255,0.1); border: 1px solid #00d4ff; color: #e0e0e0; border-radius: 4px; margin-bottom: 20px;">
                    <option value="">-- No Video Selected --</option>
                </select>
                <div class="player-container" id="playerContainer" style="display: none;">
                    <video id="mainPlayer" controls></video>
                    <div class="player-controls">
                        <div class="control-group">
                            <span class="control-label">Quality:</span>
                            <select id="qualitySelector" class="quality-selector" onchange="changeQuality()"></select>
                        </div>
                        <div class="control-group">
                            <span class="control-label">Playback Speed:</span>
                            <select id="speedSelector" class="quality-selector" onchange="changeSpeed()">
                                <option value="0.5">0.5x</option>
                                <option value="1" selected>1x</option>
                                <option value="1.5">1.5x</option>
                                <option value="2">2x</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <span class="control-label" id="playbackStats"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Testing Tab -->
        <div id="testing" class="tab-content">
            <h2 style="color: #00d4ff; margin-bottom: 20px;">üß™ Server Testing & Diagnostics</h2>
            
            <!-- Quick Access -->
            <div style="background: rgba(0, 212, 255, 0.1); border: 1px solid #00d4ff; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 10px;">üé¨ Standalone Player</h3>
                <p style="color: #a0a0a0; font-size: 12px; margin-bottom: 10px;">Test direct MP4 video streaming with our dedicated player</p>
                <a href="/player" target="_blank" style="display: inline-block; background: linear-gradient(135deg, #00d4ff 0%, #0099cc 100%); color: #000; padding: 10px 20px; border-radius: 5px; text-decoration: none; font-weight: bold;">Open Standalone Player ‚Üí</a>
            </div>
            
            <div class="test-grid">
                <div class="test-card">
                    <h3>Server Health Check</h3>
                    <p style="color: #a0a0a0; font-size: 12px; margin-bottom: 15px;">Test server connectivity and status</p>
                    <button class="test-button" onclick="testHealth()">Run Health Check</button>
                    <div class="test-result" id="healthResult"></div>
                </div>

                <div class="test-card">
                    <h3>List All Videos (API)</h3>
                    <p style="color: #a0a0a0; font-size: 12px; margin-bottom: 15px;">Fetch all videos from server</p>
                    <button class="test-button" onclick="testListVideos()">List Videos</button>
                    <div class="test-result" id="listResult"></div>
                </div>

                <div class="test-card">
                    <h3>API Response Time</h3>
                    <p style="color: #a0a0a0; font-size: 12px; margin-bottom: 15px;">Measure API latency</p>
                    <button class="test-button" onclick="testResponseTime()">Test Latency</button>
                    <div class="test-result" id="latencyResult"></div>
                </div>

                <div class="test-card">
                    <h3>Test Stream URL</h3>
                    <p style="color: #a0a0a0; font-size: 12px; margin-bottom: 15px;">Test MP4 streaming endpoint</p>
                    <input type="text" class="test-input" id="streamUrl" placeholder="e.g., /stream/{videoId}/720p.mp4">
                    <button class="test-button" onclick="testStream()">Test Stream</button>
                    <div class="test-result" id="streamResult"></div>
                </div>

                <div class="test-card">
                    <h3>Get Video by ID</h3>
                    <p style="color: #a0a0a0; font-size: 12px; margin-bottom: 15px;">Test metadata API endpoint</p>
                    <input type="text" class="test-input" id="videoIdTest" placeholder="Enter video ID">
                    <button class="test-button" onclick="testGetVideo()">Get Video</button>
                    <div class="test-result" id="videoIdResult"></div>
                </div>

                <div class="test-card">
                    <h3>File Upload Test</h3>
                    <p style="color: #a0a0a0; font-size: 12px; margin-bottom: 15px;">Test upload endpoint</p>
                    <input type="file" class="test-input" id="testUploadFile" accept="video/*">
                    <button class="test-button" onclick="testUpload()">Test Upload</button>
                    <div class="test-result" id="uploadResult"></div>
                </div>

                <div class="test-card">
                    <h3>Multi-Client Simulation</h3>
                    <p style="color: #a0a0a0; font-size: 12px; margin-bottom: 15px;">Simulate multiple concurrent clients</p>
                    <input type="number" class="test-input" id="clientCount" placeholder="Number of clients" value="5" min="1" max="100">
                    <button class="test-button" onclick="testMultiClient()">Simulate Clients</button>
                    <div class="test-result" id="multiClientResult"></div>
                </div>
            </div>
        </div>

        <!-- Stats Tab -->
        <div id="stats" class="tab-content">
            <h2 style="color: #00d4ff; margin-bottom: 20px;">üìä Server Statistics & Metrics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Videos</div>
                    <div class="stat-value" id="statTotalVideos">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Storage Used</div>
                    <div class="stat-value" id="statTotalSize">0 MB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Average Video Size</div>
                    <div class="stat-value" id="statAvgSize">0 MB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Largest Video</div>
                    <div class="stat-value" id="statLargestVideo">0 MB</div>
                </div>
            </div>
            <div class="info-section" style="margin-top: 30px;">
                <h3>Video Statistics</h3>
                <div id="videoStats" class="info-grid">
                    <p class="no-data">No videos yet. Upload a video to see statistics.</p>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h2 style="color: #00d4ff; margin-bottom: 20px;">‚öôÔ∏è Server Configuration & Settings</h2>
            
            <!-- Editable Config Form -->
            <div style="background: rgba(0,212,255,0.1); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px;">Edit Configuration</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #a0a0a0;">Log Level</label>
                        <select id="editLogLevel" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid #00d4ff; color: #e0e0e0; border-radius: 4px;">
                            <option value="ERROR">ERROR</option>
                            <option value="WARN">WARN</option>
                            <option value="INFO">INFO</option>
                            <option value="DEBUG">DEBUG</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #a0a0a0;">Max File Size (bytes)</label>
                        <input type="number" id="editMaxFileSize" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid #00d4ff; color: #e0e0e0; border-radius: 4px;">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #a0a0a0;">CORS Enabled</label>
                        <select id="editCorsEnabled" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid #00d4ff; color: #e0e0e0; border-radius: 4px;">
                            <option value="true">Yes</option>
                            <option value="false">No</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #a0a0a0;">Allowed Origins</label>
                        <input type="text" id="editAllowedOrigins" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid #00d4ff; color: #e0e0e0; border-radius: 4px;">
                    </div>
                </div>
                <div style="margin-top: 15px; display: flex; gap: 10px;">
                    <button onclick="saveConfig()" style="background: #00d4ff; color: #000; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold;">Save Configuration</button>
                    <button onclick="resetConfig()" style="background: rgba(255,0,0,0.2); color: #ff0000; border: 1px solid #ff0000; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Reset to Defaults</button>
                </div>
            </div>

            <!-- Current Config Display -->
            <div class="settings-grid">
                <div class="setting-card">
                    <h3>Server Configuration</h3>
                    <div class="setting-item">
                        <span class="setting-label">Environment</span>
                        <div class="setting-value" id="configEnv">-</div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Port</span>
                        <div class="setting-value" id="configPort">-</div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Log Level</span>
                        <div class="setting-value" id="configLogLevel">-</div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">CORS Enabled</span>
                        <div class="setting-value" id="configCors">-</div>
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Video Settings</h3>
                    <div class="setting-item">
                        <span class="setting-label">Max Upload Size</span>
                        <div class="setting-value" id="configMaxSize">-</div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Allowed Formats</span>
                        <div class="setting-value" id="configFormats">-</div>
                    </div>
                </div>

                <div class="setting-card">
                    <h3>Directory Paths</h3>
                    <div class="setting-item">
                        <span class="setting-label">Upload Directory</span>
                        <div class="setting-value" id="configUploadDir">-</div>
                    </div>
                    <div class="setting-item">
                        <span class="setting-label">Stream Directory</span>
                        <div class="setting-value" id="configStreamDir">-</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Logs Tab -->
        <div id="logs" class="tab-content">
            <h2 style="color: #00d4ff; margin-bottom: 20px;">üìã Server Logs</h2>
            
            <!-- Log Filters -->
            <div style="background: rgba(0,212,255,0.1); padding: 15px; border-radius: 8px; margin-bottom: 20px; display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #a0a0a0;">Filter by Level</label>
                    <select id="logLevelFilter" onchange="loadLogs()" style="padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid #00d4ff; color: #e0e0e0; border-radius: 4px;">
                        <option value="">All Levels</option>
                        <option value="ERROR">ERROR</option>
                        <option value="WARN">WARN</option>
                        <option value="INFO">INFO</option>
                        <option value="DEBUG">DEBUG</option>
                    </select>
                </div>
                <div style="flex: 1;">
                    <label style="display: block; margin-bottom: 5px; font-size: 12px; color: #a0a0a0;">Search</label>
                    <input type="text" id="logSearch" placeholder="Search in logs..." onkeyup="if(event.key==='Enter') loadLogs()" style="width: 100%; padding: 8px; background: rgba(255,255,255,0.1); border: 1px solid #00d4ff; color: #e0e0e0; border-radius: 4px;">
                </div>
                <div style="display: flex; gap: 10px; align-items: flex-end;">
                    <button onclick="loadLogs()" style="background: #00d4ff; color: #000; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; font-weight: bold;">Refresh</button>
                    <button onclick="clearLogs()" style="background: rgba(255,0,0,0.2); color: #ff0000; border: 1px solid #ff0000; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Clear Logs</button>
                </div>
            </div>

            <!-- Log Count -->
            <div style="margin-bottom: 10px; color: #a0a0a0; font-size: 14px;">
                Showing <span id="logCount">0</span> of <span id="logTotal">0</span> logs
            </div>

            <!-- Log Display -->
            <div id="logContainer" style="background: rgba(0,0,0,0.5); border-radius: 8px; padding: 15px; max-height: 600px; overflow-y: auto; font-family: 'Courier New', monospace; font-size: 12px;">
                <div style="color: #a0a0a0; text-align: center; padding: 20px;">No logs available</div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>üé¨ <strong>Video Streaming Server</strong> - Professional Media Management System</p>
        <p>Version 1.0 | All features enabled | <a href="/">Main Player</a></p>
    </div>

    <script>
        // Socket.IO Connection
        let socket;
        let currentUploadId = null;

        function initializeSocket() {
            socket = io(window.location.origin);

            socket.on('connect', () => {
                console.log('‚úì Socket.IO connected');
                updateSocketStatus(true);
            });

            socket.on('disconnect', () => {
                console.log('‚úó Socket.IO disconnected');
                updateSocketStatus(false);
            });

            socket.on('upload-progress', (progress) => {
                console.log('Upload progress:', progress);
                updateUploadProgress(progress);
            });

            socket.on('stats-update', (stats) => {
                console.log('Stats update:', stats);
                updateStatsDisplay(stats);
            });

            socket.on('system-notification', (notification) => {
                console.log('System notification:', notification);
                showMessage(notification.message, notification.type || 'info');
            });
        }

        function updateSocketStatus(connected) {
            const statusEl = document.getElementById('serverStatus');
            if (statusEl) {
                statusEl.textContent = connected ? '‚úì Server Connected (Live)' : '‚ö† Server Disconnected';
                statusEl.style.color = connected ? '#00ff00' : '#ff9900';
            }
        }

        function subscribeToUpload(uploadId) {
            if (socket && uploadId) {
                currentUploadId = uploadId;
                socket.emit('upload:subscribe', uploadId);
                console.log('Subscribed to upload:', uploadId);
            }
        }

        function unsubscribeFromUpload(uploadId) {
            if (socket && uploadId) {
                socket.emit('upload:unsubscribe', uploadId);
                console.log('Unsubscribed from upload:', uploadId);
                currentUploadId = null;
            }
        }

        function updateUploadProgress(progress) {
            const progressDiv = document.getElementById('uploadProgress');
            const progressBar = document.querySelector('.progress-fill');
            const progressText = document.getElementById('progressText');
            
            if (!progressDiv || !progressBar || !progressText) return;

            progressDiv.classList.add('show');
            
            // Update progress bar
            const percentage = Math.round(progress.progress || 0);
            progressBar.style.width = percentage + '%';
            progressBar.textContent = percentage + '%';

            // Update stage and message
            const stageText = getStageText(progress.stage);
            let statusHtml = `<div class="progress-stage">${stageText}</div>`;
            
            if (progress.message) {
                statusHtml += `<div class="upload-message">${progress.message}</div>`;
            }

            progressText.innerHTML = statusHtml;

            // Handle completion or failure
            if (progress.stage === 'completed') {
                setTimeout(() => {
                    progressDiv.classList.remove('show');
                    showMessage('Upload and transcoding completed successfully!', 'success');
                    loadVideos(); // Refresh video list
                    if (currentUploadId) {
                        unsubscribeFromUpload(currentUploadId);
                    }
                }, 2000);
            } else if (progress.stage === 'failed') {
                showMessage(`Upload failed: ${progress.message || 'Unknown error'}`, 'error');
                setTimeout(() => {
                    progressDiv.classList.remove('show');
                    if (currentUploadId) {
                        unsubscribeFromUpload(currentUploadId);
                    }
                }, 3000);
            }
        }

        function getStageText(stage) {
            const stages = {
                'uploading': 'üì§ Uploading file...',
                'extracting': 'üîç Extracting metadata...',
                'transcoding-360p': 'üé¨ Transcoding 360p quality...',
                'transcoding-480p': 'üé¨ Transcoding 480p quality...',
                'transcoding-720p': 'üé¨ Transcoding 720p quality...',
                'transcoding-1080p': 'üé¨ Transcoding 1080p quality...',
                'completed': '‚úÖ Processing complete!',
                'failed': '‚ùå Processing failed'
            };
            return stages[stage] || `‚è≥ ${stage}...`;
        }

        function updateStatsDisplay(stats) {
            // Update stats in the stats tab if visible
            if (document.getElementById('stats').classList.contains('active')) {
                if (stats.totalVideos !== undefined) {
                    const totalEl = document.querySelector('[data-stat="total-videos"]');
                    if (totalEl) totalEl.textContent = stats.totalVideos;
                }
                if (stats.activeUploads !== undefined) {
                    const uploadsEl = document.querySelector('[data-stat="active-uploads"]');
                    if (uploadsEl) uploadsEl.textContent = stats.activeUploads;
                }
                if (stats.activeStreams !== undefined) {
                    const streamsEl = document.querySelector('[data-stat="active-streams"]');
                    if (streamsEl) streamsEl.textContent = stats.activeStreams;
                }
            }
        }

        // Initialize Socket.IO on page load
        initializeSocket();

        // Authentication check
        const authToken = localStorage.getItem('authToken');
        if (!authToken) {
            window.location.href = '/login';
        } else {
            // Verify token is still valid
            fetch('/api/auth/verify', {
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(res => res.json())
            .then(data => {
                if (!data.success) {
                    localStorage.removeItem('authToken');
                    localStorage.removeItem('username');
                    window.location.href = '/login';
                }
            })
            .catch(() => {
                localStorage.removeItem('authToken');
                window.location.href = '/login';
            });
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('authToken');
                localStorage.removeItem('username');
                window.location.href = '/login';
            }
        }

        // Helper to make authenticated requests
        function fetchWithAuth(url, options = {}) {
            const headers = options.headers || {};
            headers['Authorization'] = `Bearer ${authToken}`;
            return fetch(url, { ...options, headers });
        }

        // Tab switching
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active from all buttons
            document.querySelectorAll('.nav-tab').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName).classList.add('active');

            // Set active button
            event.target.classList.add('active');

            // Load data for specific tabs
            if (tabName === 'videos') {
                loadVideos();
            } else if (tabName === 'player') {
                loadPlayerVideos();
            } else if (tabName === 'stats') {
                loadStats();
            } else if (tabName === 'settings') {
                loadSettings();
            } else if (tabName === 'logs') {
                loadLogs();
            }
        }

        // Message Box
        function showMessage(message, type = 'info') {
            const box = document.getElementById('messageBox');
            box.textContent = message;
            box.className = `message-box show message-${type}`;
            setTimeout(() => box.classList.remove('show'), 5000);
        }

        // File Upload
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect();
            }
        });

        fileInput.addEventListener('change', handleFileSelect);

        function handleFileSelect() {
            const file = fileInput.files[0];
            if (file) {
                uploadVideo(file);
            }
        }

        function uploadVideo(file) {
            const formData = new FormData();
            formData.append('video', file);

            const progressDiv = document.getElementById('uploadProgress');
            const statusText = document.getElementById('uploadStatus');
            const progressFill = document.getElementById('progressFill');

            progressDiv.classList.add('show');
            statusText.innerHTML = `<div class="progress-stage">üì§ Uploading: ${file.name}...</div>`;
            progressFill.style.width = '0%';
            progressFill.textContent = '0%';

            // Use XMLHttpRequest for upload progress tracking
            const xhr = new XMLHttpRequest();

            // Track upload progress
            xhr.upload.addEventListener('progress', (event) => {
                if (event.lengthComputable) {
                    const percentComplete = Math.round((event.loaded / event.total) * 100);
                    progressFill.style.width = `${percentComplete}%`;
                    progressFill.textContent = `${percentComplete}%`;
                    statusText.innerHTML = `<div class="progress-stage">üì§ Uploading: ${file.name}</div><div class="upload-message">${percentComplete}% complete</div>`;
                }
            });

            // Handle successful upload
            xhr.addEventListener('load', () => {
                if (xhr.status >= 200 && xhr.status < 300) {
                    try {
                        const data = JSON.parse(xhr.responseText);
                        if (data.success) {
                            const videoId = data.data.videoId;
                            
                            // Subscribe to real-time progress for transcoding
                            subscribeToUpload(videoId);
                            
                            statusText.innerHTML = '<div class="progress-stage">‚è≥ Upload complete! Starting transcoding...</div>';
                            
                            // Note: Progress bar will now be updated by Socket.IO events
                            // The upload is done, but transcoding continues in real-time
                        } else {
                            showMessage(`Error: ${data.message}`, 'error');
                            progressDiv.classList.remove('show');
                        }
                    } catch (error) {
                        showMessage('Error parsing server response', 'error');
                        progressDiv.classList.remove('show');
                    }
                } else {
                    showMessage(`Upload failed: ${xhr.statusText}`, 'error');
                    progressDiv.classList.remove('show');
                }
            });

            // Handle network errors
            xhr.addEventListener('error', () => {
                showMessage('Network error during upload', 'error');
                progressDiv.classList.remove('show');
            });

            // Handle upload cancellation
            xhr.addEventListener('abort', () => {
                showMessage('Upload cancelled', 'error');
                progressDiv.classList.remove('show');
            });

            // Send the request
            xhr.open('POST', '/api/upload', true);
            xhr.send(formData);
        }

        // Load Videos
        async function loadVideos() {
            try {
                const response = await fetch('/api/videos');
                const result = await response.json();

                const videoTableBody = document.getElementById('videoTableBody');
                const videoGridView = document.getElementById('videoGridView');
                const videoCount = document.getElementById('videoCount');

                if (!result.data || result.data.length === 0) {
                    videoTableBody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px; color: #a0a0a0;">
                                <div style="font-size: 48px;">üì≠</div>
                                <p>No videos uploaded yet</p>
                            </td>
                        </tr>
                    `;
                    videoGridView.innerHTML = '<div class="no-data"><div class="no-data-icon">üì≠</div><p>No videos uploaded yet</p></div>';
                    videoCount.textContent = '0';
                    return;
                }

                videoCount.textContent = result.data.length;

                // Populate Table View
                videoTableBody.innerHTML = result.data.map(video => {
                    const duration = formatDuration(video.duration || 0);
                    const fileSize = formatBytes(video.filesize || 0);
                    const uploadDate = new Date(video.createdAt).toLocaleDateString() + ' ' + 
                                     new Date(video.createdAt).toLocaleTimeString();
                    const resolutions = video.streams?.variants || [];
                    const firstStreamUrl = resolutions.length > 0 ? resolutions[0].url : '#';

                    return `
                        <tr>
                            <td style="font-weight: bold; color: #00d4ff;">${escapeHtml(video.filename)}</td>
                            <td>${duration}</td>
                            <td>
                                <div class="resolution-badges">
                                    ${resolutions.map(v => `<span class="resolution-badge">${v.preset}</span>`).join('')}
                                </div>
                            </td>
                            <td>${fileSize}</td>
                            <td>${uploadDate}</td>
                            <td>
                                <select onchange="copyTableUrl(this.value)" style="background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; color: #00d4ff; padding: 5px; border-radius: 4px; font-size: 11px;">
                                    <option value="">Select quality...</option>
                                    ${resolutions.map(v => `<option value="${v.url}">${v.preset} - ${v.resolution}</option>`).join('')}
                                </select>
                            </td>
                            <td>
                                <div class="table-actions">
                                    <button class="table-btn play" onclick="playVideo('${video.videoId}')">‚ñ∂Ô∏è Play</button>
                                    <button class="table-btn copy" onclick="copyUrl('${firstStreamUrl}')">üìã Copy</button>
                                    <button class="table-btn delete" onclick="deleteVideo('${video.videoId}')">üóëÔ∏è Delete</button>
                                </div>
                            </td>
                        </tr>
                    `;
                }).join('');

                // Populate Grid View
                videoGridView.innerHTML = result.data.map(video => {
                    const resolutions = video.streams?.variants || [];
                    const firstStreamUrl = resolutions.length > 0 ? resolutions[0].url : '#';

                    return `
                        <div class="video-card">
                            <div class="video-thumbnail">üé¨</div>
                            <div class="video-info">
                                <div class="video-title">${escapeHtml(video.filename)}</div>
                                <div class="video-meta">
                                    <div>‚è±Ô∏è ${formatDuration(video.duration || 0)}</div>
                                    <div>üìÖ ${new Date(video.createdAt).toLocaleDateString()}</div>
                                    <div>üíæ ${formatBytes(video.filesize || 0)}</div>
                                </div>
                                <div class="video-url">
                                    <small>üîó ${firstStreamUrl}</small>
                                </div>
                                <div style="margin: 8px 0;">
                                    <div class="resolution-badges">
                                        ${resolutions.map(v => `<span class="resolution-badge">${v.preset}</span>`).join('')}
                                    </div>
                                </div>
                                <div class="video-actions">
                                    <button class="btn-small btn-play" onclick="playVideo('${video.videoId}')">Play</button>
                                    <button class="btn-small btn-delete" onclick="deleteVideo('${video.videoId}')">Delete</button>
                                    <button class="btn-small" onclick="copyUrl('${firstStreamUrl}')">Copy URL</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                showMessage(`Error loading videos: ${error.message}`, 'error');
            }
        }

        function switchView(viewType) {
            const tableView = document.getElementById('videoTableView');
            const gridView = document.getElementById('videoGridView');
            const tablBtn = document.getElementById('viewTableBtn');
            const gridBtn = document.getElementById('viewGridBtn');

            if (viewType === 'table') {
                tableView.style.display = 'block';
                gridView.style.display = 'none';
                tablBtn.classList.add('active');
                gridBtn.classList.remove('active');
            } else {
                tableView.style.display = 'none';
                gridView.style.display = 'grid';
                tablBtn.classList.remove('active');
                gridBtn.classList.add('active');
            }
        }

        function formatDuration(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${String(secs).padStart(2, '0')}`;
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 B';
            const k = 1024;
            const sizes = ['B', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function copyTableUrl(url) {
            if (url) {
                copyUrl(url);
            }
        }
        
        function copyUrl(url) {
            navigator.clipboard.writeText(url).then(() => {
                showMessage('URL copied to clipboard!', 'success');
            }).catch(() => {
                showMessage('Failed to copy URL', 'error');
            });
        }

        function playVideo(videoId) {
            document.querySelector('[onclick="switchTab(\'player\')"]').click();
            document.getElementById('playerVideoSelect').value = videoId;
            loadPlayerStream(videoId);
        }

        async function deleteVideo(videoId) {
            if (!confirm('Are you sure you want to delete this video?')) return;

            try {
                const response = await fetch(`/api/video/${videoId}`, {
                    method: 'DELETE'
                });
                const data = await response.json();

                if (data.success) {
                    showMessage('Video deleted successfully', 'success');
                    loadVideos();
                } else {
                    showMessage(`Error: ${data.message}`, 'error');
                }
            } catch (error) {
                showMessage(`Delete failed: ${error.message}`, 'error');
            }
        }

        // Player
        async function loadPlayerVideos() {
            try {
                const response = await fetch('/api/videos');
                const data = await response.json();
                const select = document.getElementById('playerVideoSelect');

                if (data.success && data.data && data.data.length > 0) {
                    const options = data.data.map(v => 
                        `<option value="${v.videoId}">${v.filename}</option>`
                    ).join('');
                    select.innerHTML = '<option value="">-- No Video Selected --</option>' + options;
                } else {
                    select.innerHTML = '<option value="">-- No videos available --</option>';
                }
            } catch (error) {
                showMessage(`Error loading videos: ${error.message}`, 'error');
                select.innerHTML = '<option value="">-- Error loading videos --</option>';
            }
        }

        document.getElementById('playerVideoSelect').addEventListener('change', (e) => {
            if (e.target.value) {
                loadPlayerStream(e.target.value);
            } else {
                // Clean up when no video selected
                const video = document.getElementById('mainPlayer');
                video.pause();
                video.src = '';
                document.getElementById('playerContainer').style.display = 'none';
            }
        });

        async function loadPlayerStream(videoId) {
            try {
                const playerContainer = document.getElementById('playerContainer');
                const video = document.getElementById('mainPlayer');
                const qualitySelector = document.getElementById('qualitySelector');

                // Clean up previous stream
                video.pause();
                video.src = '';

                playerContainer.style.display = 'block';

                // Get available qualities
                const response = await fetch(`/api/video/${videoId}`);
                const result = await response.json();

                if (result.success) {
                    // Extract available qualities from streams.variants
                    const qualities = (result.data.streams?.variants || []);
                    
                    qualitySelector.innerHTML = qualities.map(q => 
                        `<option value="${q.url}">${q.preset} (${q.resolution})</option>`
                    ).join('');

                    // Load first quality by default (usually 720p or best available)
                    const defaultQuality = qualities.find(q => q.preset === '720p') || qualities[0];
                    
                    if (defaultQuality) {
                        qualitySelector.value = defaultQuality.url;
                        video.src = defaultQuality.url;
                        
                        video.addEventListener('loadedmetadata', () => {
                            showMessage('Video loaded successfully', 'success');
                            video.play().catch(err => {
                                console.warn('Autoplay prevented:', err);
                                showMessage('Click play button to start video', 'info');
                            });
                        }, { once: true });

                        video.addEventListener('error', (e) => {
                            console.error('Video Error:', e);
                            showMessage(`Playback error: ${video.error?.message || 'Unknown error'}`, 'error');
                        }, { once: true });
                    } else {
                        showMessage('No video streams available', 'error');
                    }
                }
            } catch (error) {
                showMessage(`Error loading stream: ${error.message}`, 'error');
            }
        }

        function changeQuality() {
            const video = document.getElementById('mainPlayer');
            const qualitySelector = document.getElementById('qualitySelector');
            const selectedUrl = qualitySelector.value;
            
            if (selectedUrl) {
                const currentTime = video.currentTime;
                video.src = selectedUrl;
                video.currentTime = currentTime;
                video.play().catch(err => console.warn('Playback prevented:', err));
                showMessage('Quality changed', 'info');
            }
        }

        function changeSpeed() {
            const video = document.getElementById('mainPlayer');
            const speed = document.getElementById('speedSelector').value;
            video.playbackRate = parseFloat(speed);
        }

        // Testing Functions
        async function testHealth() {
            const result = document.getElementById('healthResult');
            try {
                const start = Date.now();
                const response = await fetch('/health');
                const time = Date.now() - start;
                const data = await response.json();

                result.innerHTML = `‚úì Server is healthy<br/>Response Time: ${time}ms<br/>Status: ${data.message}`;
                result.classList.add('show', 'result-success');
            } catch (error) {
                result.innerHTML = `‚úó Error: ${error.message}`;
                result.classList.add('show', 'result-error');
            }
        }

        async function testListVideos() {
            const result = document.getElementById('listResult');
            try {
                const response = await fetch('/api/videos');
                const data = await response.json();

                const count = data.count || 0;
                result.innerHTML = `‚úì Found ${count} videos\n\n${JSON.stringify(data, null, 2)}`;
                result.classList.add('show', 'result-success');
            } catch (error) {
                result.innerHTML = `‚úó Error: ${error.message}`;
                result.classList.add('show', 'result-error');
            }
        }

        async function testResponseTime() {
            const result = document.getElementById('latencyResult');
            try {
                let totalTime = 0;
                const requests = 10;

                for (let i = 0; i < requests; i++) {
                    const start = Date.now();
                    await fetch('/health');
                    totalTime += Date.now() - start;
                }

                const avgTime = totalTime / requests;
                result.innerHTML = `‚úì Average Response Time: ${avgTime.toFixed(2)}ms\nTotal Requests: ${requests}\nTotal Time: ${totalTime}ms`;
                result.classList.add('show', 'result-success');
            } catch (error) {
                result.innerHTML = `‚úó Error: ${error.message}`;
                result.classList.add('show', 'result-error');
            }
        }

        async function testStream() {
            const result = document.getElementById('streamResult');
            const url = document.getElementById('streamUrl').value;

            if (!url) {
                result.innerHTML = '‚úó Please enter a stream URL';
                result.classList.add('show', 'result-error');
                return;
            }

            try {
                const fullUrl = url.startsWith('http') ? url : window.location.origin + url;
                const response = await fetch(fullUrl, { method: 'HEAD' });
                
                if (response.ok) {
                    const contentType = response.headers.get('content-type');
                    const contentLength = response.headers.get('content-length');
                    const acceptRanges = response.headers.get('accept-ranges');
                    
                    result.innerHTML = `‚úì Stream URL is accessible
Status: ${response.status}
Content-Type: ${contentType || 'N/A'}
Content-Length: ${contentLength ? formatBytes(parseInt(contentLength)) : 'N/A'}
Accept-Ranges: ${acceptRanges || 'N/A'}

${acceptRanges === 'bytes' ? '‚úì Range requests supported (seeking enabled)' : '‚ö† No range support'}`;
                    result.classList.add('show', 'result-success');
                } else {
                    result.innerHTML = `‚úó Stream returned status: ${response.status}`;
                    result.classList.add('show', 'result-error');
                }
            } catch (error) {
                result.innerHTML = `‚úó Error: ${error.message}`;
                result.classList.add('show', 'result-error');
            }
        }

        async function testGetVideo() {
            const result = document.getElementById('videoIdResult');
            const videoId = document.getElementById('videoIdTest').value.trim();

            if (!videoId) {
                result.innerHTML = '‚úó Please enter a video ID';
                result.classList.add('show', 'result-error');
                return;
            }

            try {
                const response = await fetch(`/api/video/${videoId}`);
                const data = await response.json();

                if (response.ok && data.success) {
                    const video = data.data;
                    const variants = video.streams?.variants || [];
                    
                    result.innerHTML = `‚úì Video found!

<strong>Video ID:</strong> ${video.videoId}
<strong>Filename:</strong> ${video.filename}
<strong>Duration:</strong> ${formatDuration(video.duration || 0)}
<strong>File Size:</strong> ${formatBytes(video.filesize || 0)}
<strong>Upload Date:</strong> ${new Date(video.createdAt).toLocaleString()}

<strong>Metadata:</strong>
- Resolution: ${video.metadata?.width}x${video.metadata?.height}
- Codec: ${video.metadata?.codec || 'N/A'}
- FPS: ${video.metadata?.fps || 'N/A'}

<strong>Available Qualities:</strong>
${variants.map(v => `- ${v.preset} (${v.resolution}): ${v.url}`).join('\n')}`;
                    result.classList.add('show', 'result-success');
                } else {
                    result.innerHTML = `‚úó Video not found: ${data.error?.message || 'Unknown error'}`;
                    result.classList.add('show', 'result-error');
                }
            } catch (error) {
                result.innerHTML = `‚úó Error: ${error.message}`;
                result.classList.add('show', 'result-error');
            }
        }

        async function testUpload() {
            const result = document.getElementById('uploadResult');
            const file = document.getElementById('testUploadFile').files[0];

            if (!file) {
                result.innerHTML = '‚úó Please select a file';
                result.classList.add('show', 'result-error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('video', file);

                const start = Date.now();
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                const time = Date.now() - start;
                const data = await response.json();

                if (data.success) {
                    result.innerHTML = `‚úì Upload successful\nTime: ${time}ms\nVideo ID: ${data.videoId}`;
                    result.classList.add('show', 'result-success');
                } else {
                    result.innerHTML = `‚úó Error: ${data.message}`;
                    result.classList.add('show', 'result-error');
                }
            } catch (error) {
                result.innerHTML = `‚úó Error: ${error.message}`;
                result.classList.add('show', 'result-error');
            }
        }

        async function testMultiClient() {
            const result = document.getElementById('multiClientResult');
            const clientCount = parseInt(document.getElementById('clientCount').value) || 5;

            result.innerHTML = `Simulating ${clientCount} concurrent clients...`;
            result.classList.add('show', 'result-success');

            try {
                const start = Date.now();
                const promises = [];

                for (let i = 0; i < clientCount; i++) {
                    promises.push(
                        fetch('/health').then(r => r.json())
                    );
                }

                await Promise.all(promises);
                const time = Date.now() - start;

                result.innerHTML = `‚úì Successfully simulated ${clientCount} concurrent clients\nTotal Time: ${time}ms\nAverage: ${(time/clientCount).toFixed(2)}ms per client`;
                result.classList.add('show', 'result-success');
            } catch (error) {
                result.innerHTML = `‚úó Error: ${error.message}`;
                result.classList.add('show', 'result-error');
            }
        }

        // Stats
        async function loadStats() {
            try {
                const response = await fetch('/api/videos');
                const data = await response.json();
                const videos = data.videos || [];

                let totalSize = 0;
                videos.forEach(v => totalSize += v.size);

                document.getElementById('statTotalVideos').textContent = videos.length;
                document.getElementById('statTotalSize').textContent = (totalSize / (1024*1024)).toFixed(2) + ' MB';
                document.getElementById('statAvgSize').textContent = videos.length > 0 ? (totalSize / videos.length / (1024*1024)).toFixed(2) + ' MB' : '0 MB';

                const largest = videos.length > 0 ? Math.max(...videos.map(v => v.size)) : 0;
                document.getElementById('statLargestVideo').textContent = (largest / (1024*1024)).toFixed(2) + ' MB';

                const statsHtml = videos.map(v => `
                    <div class="info-item">
                        <div class="info-label">${v.name}</div>
                        <div class="info-value">${(v.size / (1024*1024)).toFixed(2)} MB</div>
                    </div>
                `).join('');

                document.getElementById('videoStats').innerHTML = statsHtml || '<p class="no-data">No videos yet</p>';
            } catch (error) {
                showMessage(`Error loading stats: ${error.message}`, 'error');
            }
        }

        // Settings
        async function loadSettings() {
            try {
                const response = await fetchWithAuth('/api/admin/config');
                const result = await response.json();
                
                if (result.success) {
                    const config = result.data;
                    
                    // Display current config
                    document.getElementById('configEnv').textContent = config.NODE_ENV || '-';
                    document.getElementById('configPort').textContent = config.PORT || '-';
                    document.getElementById('configLogLevel').textContent = config.LOG_LEVEL || '-';
                    document.getElementById('configCors').textContent = config.CORS_ENABLED ? 'enabled' : 'disabled';
                    document.getElementById('configMaxSize').textContent = formatBytes(config.MAX_FILE_SIZE || 0);
                    document.getElementById('configFormats').textContent = (config.ALLOWED_FORMATS || []).join(', ');
                    document.getElementById('configUploadDir').textContent = config.UPLOADS_DIR || '-';
                    document.getElementById('configStreamDir').textContent = config.STREAMS_DIR || '-';
                    
                    // Populate edit form
                    document.getElementById('editLogLevel').value = config.LOG_LEVEL || 'INFO';
                    document.getElementById('editMaxFileSize').value = config.MAX_FILE_SIZE || 500000000;
                    document.getElementById('editCorsEnabled').value = config.CORS_ENABLED ? 'true' : 'false';
                    document.getElementById('editAllowedOrigins').value = config.ALLOWED_ORIGINS || '*';
                }
            } catch (error) {
                showMessage('Failed to load configuration', 'error');
            }
        }

        async function saveConfig() {
            const updates = {
                LOG_LEVEL: document.getElementById('editLogLevel').value,
                MAX_FILE_SIZE: parseInt(document.getElementById('editMaxFileSize').value),
                CORS_ENABLED: document.getElementById('editCorsEnabled').value,
                ALLOWED_ORIGINS: document.getElementById('editAllowedOrigins').value
            };

            try {
                const response = await fetchWithAuth('/api/admin/config', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(updates)
                });

                const result = await response.json();
                
                if (result.success) {
                    showMessage('Configuration saved successfully! Server restart may be required.', 'success');
                    loadSettings();
                } else {
                    showMessage(result.error?.message || 'Failed to save configuration', 'error');
                }
            } catch (error) {
                showMessage('Error saving configuration', 'error');
            }
        }

        async function resetConfig() {
            if (!confirm('Reset configuration to defaults? This will restart the server.')) return;

            try {
                const response = await fetchWithAuth('/api/admin/config/reset', {
                    method: 'POST'
                });

                const result = await response.json();
                
                if (result.success) {
                    showMessage('Configuration reset to defaults', 'success');
                    loadSettings();
                } else {
                    showMessage('Failed to reset configuration', 'error');
                }
            } catch (error) {
                showMessage('Error resetting configuration', 'error');
            }
        }

        async function loadLogs() {
            const level = document.getElementById('logLevelFilter').value;
            const search = document.getElementById('logSearch').value;
            
            const params = new URLSearchParams();
            if (level) params.append('level', level);
            if (search) params.append('search', search);
            params.append('limit', '500');

            try {
                const response = await fetchWithAuth(`/api/admin/logs?${params}`);
                const result = await response.json();
                
                if (result.success) {
                    const logs = result.data;
                    document.getElementById('logCount').textContent = result.count;
                    document.getElementById('logTotal').textContent = result.total;
                    
                    const container = document.getElementById('logContainer');
                    if (logs.length === 0) {
                        container.innerHTML = '<div style="color: #a0a0a0; text-align: center; padding: 20px;">No logs available</div>';
                    } else {
                        container.innerHTML = logs.map(log => {
                            const levelColor = {
                                'ERROR': '#ff0000',
                                'WARN': '#ff9900',
                                'INFO': '#00d4ff',
                                'DEBUG': '#00ff00'
                            }[log.level] || '#a0a0a0';
                            
                            return `
                                <div style="margin-bottom: 10px; padding: 8px; background: rgba(0,0,0,0.3); border-left: 3px solid ${levelColor}; border-radius: 4px;">
                                    <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 5px;">
                                        <span style="color: ${levelColor}; font-weight: bold;">[${log.level}]</span>
                                        <span style="color: #666; font-size: 11px;">${new Date(log.timestamp).toLocaleString()}</span>
                                    </div>
                                    <div style="color: #e0e0e0;">${log.message}</div>
                                    ${log.metadata ? `<div style="color: #888; font-size: 11px; margin-top: 5px;">${JSON.stringify(log.metadata)}</div>` : ''}
                                </div>
                            `;
                        }).join('');
                    }
                }
            } catch (error) {
                showMessage('Failed to load logs', 'error');
            }
        }

        async function clearLogs() {
            if (!confirm('Clear all logs?')) return;

            try {
                const response = await fetchWithAuth('/api/admin/logs', {
                    method: 'DELETE'
                });

                const result = await response.json();
                
                if (result.success) {
                    showMessage('Logs cleared successfully', 'success');
                    loadLogs();
                }
            } catch (error) {
                showMessage('Failed to clear logs', 'error');
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Check server status
        async function checkServerStatus() {
            try {
                const response = await fetch('/health');
                if (response.ok) {
                    document.getElementById('serverStatus').textContent = '‚úì Server Connected';
                } else {
                    document.getElementById('serverStatus').textContent = '‚ö† Server Error';
                }
            } catch (error) {
                document.getElementById('serverStatus').textContent = '‚úó Server Offline';
            }
        }

        // Initialize
        const username = localStorage.getItem('username');
        if (username) {
            document.getElementById('userInfo').textContent = `üë§ ${username}`;
        }
        
        setInterval(checkServerStatus, 5000);
        checkServerStatus();
    </script>
</body>
</html>
